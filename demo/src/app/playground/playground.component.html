<section class="playground">
  <h2>Playground</h2>

  <!-- TTAAII Input -->
  <div class="input-section">
    <mat-form-field appearance="outline" class="ttaaii-input">
      <mat-label>TTAAII Code</mat-label>
      <input
        #inputEl
        matInput
        [value]="inputValue()"
        (input)="onInputChange($any($event.target).value)"
        (keydown.control.space)="openPanel()"
        [matAutocomplete]="auto"
        [matAutocompleteDisabled]="false"
        placeholder="SAFR01"
        maxlength="6"
        autocomplete="off"
      />
      <mat-hint>{{ fieldLabels[currentField()] }} (Position {{ position() }})</mat-hint>
      @if (inputValue()) {
        <button matSuffix mat-icon-button (click)="clearInput()" matTooltip="Clear">
          <mat-icon>clear</mat-icon>
        </button>
      }

      <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selectOption($event.option.value)" class="ttaaii-autocomplete">
        @if (groups(); as groupList) {
          <!-- Grouped display -->
          @for (group of groupList; track trackByKey($index, group)) {
            <mat-optgroup [label]="group.label">
              @for (item of group.items; track trackByCode($index, item)) {
                <mat-option [value]="item">
                  <div class="option-content">
                    <div class="option-main">
                      <span class="option-code">{{ item.code }}</span>
                      <span class="option-label">{{ item.label }}</span>
                    </div>
                    @if (item.codeForm) {
                      <div class="option-secondary">{{ item.codeForm }}</div>
                    }
                  </div>
                </mat-option>
              }
            </mat-optgroup>
          }
        } @else {
          <!-- Flat list -->
          @for (item of filteredItems(); track trackByCode($index, item)) {
            <mat-option [value]="item">
              <div class="option-content">
                <div class="option-main">
                  <span class="option-code">{{ item.code }}</span>
                  <span class="option-label">{{ item.label }}</span>
                </div>
                @if (item.codeForm) {
                  <div class="option-secondary">{{ item.codeForm }}</div>
                }
              </div>
            </mat-option>
          }
        }
      </mat-autocomplete>
    </mat-form-field>

    <div class="input-actions">
      <button mat-stroked-button (click)="backspace()" [disabled]="!inputValue()">
        <mat-icon>backspace</mat-icon>
      </button>
      <button mat-stroked-button (click)="toggleGrouping()" [class.active]="groupByContinent()">
        <mat-icon>{{ groupByContinent() ? 'folder' : 'list' }}</mat-icon>
        {{ groupByContinent() ? 'Grouped' : 'Flat' }}
      </button>
    </div>
  </div>

  <!-- Current Code Display -->
  <div class="code-display">
    <div class="code-chars">
      @for (char of ['T1', 'T2', 'A1', 'A2', 'i', 'i']; track $index; let i = $index) {
        <div class="char-box" [class.active]="position() === i" [class.filled]="inputValue().length > i">
          <span class="char-label">{{ char }}</span>
          <span class="char-value">{{ inputValue()[i] || '_' }}</span>
        </div>
      }
    </div>

    @if (isComplete()) {
      <mat-chip class="complete-chip" highlighted>
        <mat-icon>check_circle</mat-icon>
        Complete
      </mat-chip>
    }
  </div>

  <!-- Decoded JSON -->
  @if (inputValue()) {
    <div class="decoded-section">
      <h3>Decoded Output</h3>
      <interactive-code language="json">
        <textarea>{{ decodedJson() }}</textarea>
      </interactive-code>
    </div>
  }

  <!-- Usage Examples -->
  <div class="usage-section">
    <h3>Usage</h3>

    <h4>Flat List (default)</h4>
    <interactive-code language="typescript">
      <textarea>const result = provider.complete('SA');
// result.items = [
//   { code: 'A', label: 'Afghanistan' },
//   { code: 'B', label: 'Albania' },
//   ...
// ]</textarea>
    </interactive-code>

    <h4>Grouped by Continent</h4>
    <interactive-code language="typescript">
      <textarea>const result = provider.complete('SA', { groupBy: 'continent' });
// result.groups = [
//   { key: 'EU', label: 'Europe', items: [...] },
//   { key: 'AF', label: 'Africa', items: [...] },
//   ...
// ]</textarea>
    </interactive-code>
  </div>
</section>
